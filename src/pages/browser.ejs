<div id="display"
    style="padding: 1em; margin: 2em; max-width: 800px; justify-content: center; background-color: white; box-shadow: 1px 1px;">
</div>
<div id="comments"
    style="padding: 1em; margin: 2em; max-width: 800px; justify-content: center; background-color: white; box-shadow: 1px 1px;">

</div>


<script src="https://cdn.jsdelivr.net/remarkable/1.7.1/remarkable.min.js"></script>
<script>
    var md = new Remarkable();
    md.set({
        html: true,
        breaks: true,
        xhtmlOut: true,
        linkify: true
    });

    if (getQueryVariable("tag") !== false) {
        tag = getQueryVariable("tag");
    } else if (getQueryVariable("post") !== false) {
        tag = "null";
        post = "true"
    } else {
        tag = "blokz"
    }


    window.onload = function loading() {
        // sample link : 
        // https://peakd.com/@morning/steem-api-guide-how-to-get-recent-posts-getdiscussionsbycreated-load-more-and-pagination
        // https://peakd.com/                   @sn0n/blokzprofile
        // http://127.0.0.1:3000/browser/?post= @sn0n/blokzprofile
        var oldestPermLink = "";

        if (tag !== "null") {
            hive.api.getDiscussionsByCreated({ "tag": tag, "limit": 10 }, function (err, result) {
                if (err === null) {
                    var i, len = result.length;

                    document.getElementById("display").innerHTML += "<small>most recent</small><div style='font-size: 300%; padding: .1em; margin: .2em'> " + tag + "</div>";
                    for (i = 0; i < len; i++) {
                        var discussion = result[i];
                        console.log(i, discussion);
                        console.log("who dun it " + discussion.author);
                        console.log("where do i find it? @" + discussion.author + "/" + discussion.permlink);
                        document.getElementById("display").innerHTML += "<a href='?post=@" + discussion.author + "/" + discussion.permlink + "'>" + discussion.title + "</a><br /> by " + discussion.author + " on " + discussion.created.slice(0, 10) + "<br />";

                    }
                } else {
                    console.log(err);
                }
            });
        } else if (post === "true") {


            var letting = getQueryVariable("post").split("/");

            author = letting[0].replace("@", '');
            permlink = letting[1];

            console.log("letting : " + author + permlink);
            hive.api.getContent(author, permlink, function (err, result) {
                console.log(err, result);

                post1 = md.render(result.body).replace("\n", "");
                //post1 = post1.replace(new RegExp("<img ", 'g'), "<img width='80%' ");

                document.getElementById("display").innerHTML += "<h6>" + result.title  + "</h6>";

                document.getElementById("display").innerHTML += "<br />Posted by <a href='../?hive=" + result.author + "'>@" + result.author + "</a>";
           
     document.getElementById("display").innerHTML += "<br />on " + result.created.slice(0, 10) + "<hr>";


                document.getElementById("display").innerHTML += md.render(post1);
                document.getElementById("display").innerHTML += "<hr /> tags: <br />";


                jsonTAGS = JSON.parse(result.json_metadata);
                jsonTAGS.tags.forEach(myFunction);
                function myFunction(item, index) {
                    document.getElementById("display").innerHTML += "<a href='?tag=" + item + "'>" + item + "</a> &nbsp;";
                }

                // todo : comments

                document.getElementById("comments").innerHTML += "<h3>Comments</h3>";

                hive.api.getContentReplies(author, permlink, function (err, result) {
                    console.log(err, result);
                    if (result.length > 0) {
                        console.log("testing number " + result.length)

                        comments = JSON.stringify(result[0].author);

                        for (var i = 0; i < result.length; i++) {
                            console.log(" for loop data : " + JSON.stringify(result[i]));
                            thisPost = JSON.parse(JSON.stringify(result[i]));
                            console.log("who dis " + thisPost.author);
                            console.log("i is " + i);
                            document.getElementById("comments").innerHTML += "<div id='comm'>" + thisPost.author + " <a href='?post=@" + thisPost.author + "/" + thisPost.permlink + "'>says</a>: " + md.render(result[i].body) + "</div>";

                            // if parent_author is listed, put on top of post

                        }


                        console.log("comment from: " + comments);
                    } else {
                        console.log("no comments");
                        document.getElementById("comments").innerHTML += "no comments to show";

                    }
                });


            });



        };














    }
</script>